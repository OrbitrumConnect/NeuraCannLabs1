<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannabis Clinical Hub - Dashboard M√©dico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script src="https://unpkg.com/@react-three/fiber@8.15.11/dist/index.umd.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'neon-cyan': '#22D3EE',
                        'dark-cyan': '#0891B2',
                        'cyberpunk-dark': '#0F0F0F',
                    },
                    animation: {
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        glow: {
                            '0%': { boxShadow: '0 0 5px #22D3EE, 0 0 10px #22D3EE, 0 0 15px #22D3EE' },
                            '100%': { boxShadow: '0 0 10px #22D3EE, 0 0 20px #22D3EE, 0 0 30px #22D3EE' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        };
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #111827 0%, #1F2937 100%);
        }
        
        .neon-border {
            border: 1px solid #22D3EE;
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.3);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(34, 211, 238, 0.3);
        }
        
        .sidebar-overlay {
            backdrop-filter: blur(10px);
            background: rgba(31, 41, 55, 0.95);
        }

        .loading-dot {
            animation: loading 1.4s infinite ease-in-out;
        }
        
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes loading {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-inter">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // @COMPONENT: Avatar3D - 3D animated wireframe sphere using Three.js
        function Avatar3D() {
            const mountRef = useRef(null);
            const sceneRef = useRef(null);
            const rendererRef = useRef(null);
            const sphereRef = useRef(null);

            useEffect(() => {
                if (!mountRef.current) return;

                // Three.js setup
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                
                renderer.setSize(120, 120);
                renderer.setClearColor(0x000000, 0);
                mountRef.current.appendChild(renderer.domElement);

                // Create wireframe sphere
                const geometry = new THREE.SphereGeometry(1, 20, 20);
                const material = new THREE.MeshBasicMaterial({ 
                    color: 0x22D3EE, 
                    wireframe: true,
                    transparent: true,
                    opacity: 0.8
                });
                const sphere = new THREE.Mesh(geometry, material);
                scene.add(sphere);

                // Add some ambient lighting effect
                const light = new THREE.AmbientLight(0x22D3EE, 0.5);
                scene.add(light);

                camera.position.z = 2.5;

                sceneRef.current = scene;
                rendererRef.current = renderer;
                sphereRef.current = sphere;

                // Animation loop
                const animate = () => {
                    requestAnimationFrame(animate);
                    if (sphereRef.current) {
                        sphereRef.current.rotation.y += 0.01;
                        sphereRef.current.rotation.x += 0.005;
                    }
                    renderer.render(scene, camera);
                };
                animate();

                return () => {
                    if (mountRef.current && renderer.domElement) {
                        mountRef.current.removeChild(renderer.domElement);
                    }
                    renderer.dispose();
                };
            }, []);

            return (
                <div className="w-32 h-32 flex items-center justify-center animate-float">
                    <div 
                        ref={mountRef} 
                        className="rounded-full neon-glow"
                        style={{ width: '120px', height: '120px' }}
                    />
                </div>
            );
        }
        // @END_COMPONENT: Avatar3D

        // @COMPONENT: LoadingSpinner - Animated loading indicator
        function LoadingSpinner() {
            return (
                <div className="flex items-center justify-center p-8">
                    <div className="flex space-x-2">
                        <div className="w-3 h-3 bg-cyan-400 rounded-full loading-dot"></div>
                        <div className="w-3 h-3 bg-cyan-400 rounded-full loading-dot"></div>
                        <div className="w-3 h-3 bg-cyan-400 rounded-full loading-dot"></div>
                    </div>
                    <span className="ml-4 text-cyan-400 animate-pulse">Carregando dados...</span>
                </div>
            );
        }
        // @END_COMPONENT: LoadingSpinner

        // @COMPONENT: DashboardCard - Reusable card component with neon styling
        function DashboardCard({ title, children, loading }) {
            return (
                <div className="bg-gray-800 rounded-xl p-6 neon-border card-hover">
                    <h3 className="text-xl font-semibold text-cyan-400 mb-4 flex items-center">
                        <span className="w-2 h-2 bg-cyan-400 rounded-full mr-3 animate-pulse"></span>
                        {title}
                    </h3>
                    {loading ? <LoadingSpinner /> : children}
                </div>
            );
        }
        // @END_COMPONENT: DashboardCard

        // @COMPONENT: DataList - Formatted list for displaying API data
        function DataList({ items, type }) {
            if (!items || items.length === 0) {
                return (
                    <div className="text-gray-400 text-center p-4">
                        <p>Nenhum dado dispon√≠vel</p>
                    </div>
                );
            }

            return (
                <div className="space-y-3">
                    {/* @MAP: items.map(item => ( */}
                    {items.map((item) => (
                        <div key={item.id} className="bg-gray-700 rounded-lg p-4 border-l-4 border-cyan-400 hover:bg-gray-600 transition-colors">
                            {type === 'scientific' && (
                                <>
                                    <h4 className="font-semibold text-gray-100">{item.title}</h4>
                                    <p className="text-sm text-cyan-300 mt-1">Data: {item.date}</p>
                                </>
                            )}
                            {type === 'clinical' && (
                                <>
                                    <p className="text-gray-100">{item.description}</p>
                                    <p className="text-sm text-cyan-300 mt-1">Respons√°vel: {item.doctor}</p>
                                </>
                            )}
                            {type === 'alerts' && (
                                <>
                                    <p className="text-gray-100">{item.message}</p>
                                    <p className="text-sm text-cyan-300 mt-1">Data: {item.date}</p>
                                </>
                            )}
                        </div>
                    ))}
                    {/* @END_MAP )) */}
                </div>
            );
        }
        // @END_COMPONENT: DataList

        // @COMPONENT: App - Main application component
        function App() {
            // @STATE: Component state management
            const [menuOpen, setMenuOpen] = useState(false);
            const [dashboard, setDashboard] = useState("scientific");
            const [scientificData, setScientificData] = useState([]);
            const [clinicalCases, setClinicalCases] = useState([]);
            const [alerts, setAlerts] = useState([]);
            const [profile, setProfile] = useState(null);
            const [loading, setLoading] = useState(true);

            // Mock API data (simulating the Express backend)
            const mockApiData = {
                scientific: [
                    { id: 1, title: "Estudo A sobre CBD e Epilepsia", date: "2025-07-01" },
                    { id: 2, title: "Pesquisa B sobre THC e dor cr√¥nica", date: "2025-07-05" },
                    { id: 3, title: "An√°lise de CBG para dist√∫rbios neurol√≥gicos", date: "2025-07-12" },
                    { id: 4, title: "Efic√°cia do CBD no tratamento de ansiedade", date: "2025-07-15" }
                ],
                clinical: [
                    { id: 1, description: "Paciente X melhorou ap√≥s uso de CBD", doctor: "Dr. Silva" },
                    { id: 2, description: "Paciente Y apresentou efeitos adversos leves", doctor: "Dra. Souza" },
                    { id: 3, description: "Redu√ß√£o significativa de convuls√µes em paciente pedi√°trico", doctor: "Dr. Santos" },
                    { id: 4, description: "Melhora na qualidade do sono com uso de CBN", doctor: "Dra. Oliveira" }
                ],
                alerts: [
                    { id: 1, message: "Novo protocolo aprovado para uso de cannabis em SP", date: "2025-07-10" },
                    { id: 2, message: "Artigo importante publicado sobre CBG", date: "2025-07-11" },
                    { id: 3, message: "Atualiza√ß√£o nas diretrizes de prescri√ß√£o", date: "2025-07-13" },
                    { id: 4, message: "Workshop sobre cannabis medicinal - 20/07", date: "2025-07-14" }
                ],
                profile: {
                    name: "Dr. Jo√£o",
                    specialty: "Neurologia",
                    email: "joao@example.com",
                    license: "CRM-SP 123456",
                    institution: "Hospital das Cl√≠nicas"
                }
            };

            // Simulated API fetch function
            async function fetchData(endpoint, setData) {
                try {
                    // Simulate network delay
                    await new Promise(resolve => setTimeout(resolve, 800));
                    const data = mockApiData[endpoint];
                    setData(data);
                } catch (err) {
                    console.error(`Erro ao buscar ${endpoint}`, err);
                }
            }

            useEffect(() => {
                setLoading(true);
                Promise.all([
                    fetchData("scientific", setScientificData),
                    fetchData("clinical", setClinicalCases),
                    fetchData("alerts", setAlerts),
                    fetchData("profile", setProfile),
                ]).finally(() => setLoading(false));
            }, []);

            const dashboards = {
                scientific: {
                    title: "Dados Cient√≠ficos",
                    icon: "üß¨",
                    content: <DataList items={scientificData} type="scientific" />
                },
                clinical: {
                    title: "Casos Cl√≠nicos", 
                    icon: "üë®‚Äç‚öïÔ∏è",
                    content: <DataList items={clinicalCases} type="clinical" />
                },
                alerts: {
                    title: "Alertas",
                    icon: "üîî", 
                    content: <DataList items={alerts} type="alerts" />
                },
                profile: {
                    title: "Perfil",
                    icon: "üë§",
                    content: (
                        <div className="space-y-4">
                            {loading || !profile ? (
                                <LoadingSpinner />
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-gray-700 rounded-lg p-4">
                                        <label className="text-sm text-cyan-300">Nome</label>
                                        <p className="text-lg font-semibold text-gray-100">{profile.name}</p>
                                    </div>
                                    <div className="bg-gray-700 rounded-lg p-4">
                                        <label className="text-sm text-cyan-300">Especialidade</label>
                                        <p className="text-lg font-semibold text-gray-100">{profile.specialty}</p>
                                    </div>
                                    <div className="bg-gray-700 rounded-lg p-4">
                                        <label className="text-sm text-cyan-300">Email</label>
                                        <p className="text-lg font-semibold text-gray-100">{profile.email}</p>
                                    </div>
                                    <div className="bg-gray-700 rounded-lg p-4">
                                        <label className="text-sm text-cyan-300">CRM</label>
                                        <p className="text-lg font-semibold text-gray-100">{profile.license}</p>
                                    </div>
                                    <div className="bg-gray-700 rounded-lg p-4 md:col-span-2">
                                        <label className="text-sm text-cyan-300">Institui√ß√£o</label>
                                        <p className="text-lg font-semibold text-gray-100">{profile.institution}</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    )
                },
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-100 flex flex-col">
                    {/* @COMPONENT: Header - Fixed navigation header */}
                    <header className="flex items-center justify-between bg-gray-800 px-6 py-4 shadow-xl fixed w-full z-20 top-0 neon-border">
                        <h1 className="text-2xl font-bold text-cyan-400 cursor-default select-none flex items-center">
                            <span className="text-3xl mr-3">üåø</span>
                            Cannabis Clinical Hub
                        </h1>
                        <button
                            aria-label="Menu"
                            className="focus:outline-none p-2 rounded-lg hover:bg-gray-700 transition-colors"
                            onClick={() => setMenuOpen(!menuOpen)}
                            data-event="click:toggleMenu"
                        >
                            <svg
                                className="w-8 h-8 text-cyan-400"
                                fill="none"
                                stroke="currentColor"
                                strokeWidth="2"
                                viewBox="0 0 24 24"
                                strokeLinecap="round"
                                strokeLinejoin="round"
                            >
                                <path d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </header>
                    {/* @END_COMPONENT: Header */}

                    {/* @COMPONENT: Sidebar - Sliding navigation menu */}
                    <nav
                        className={`fixed top-0 left-0 h-full w-80 sidebar-overlay shadow-2xl transform transition-transform duration-300 z-30 ${
                            menuOpen ? "translate-x-0" : "-translate-x-full"
                        }`}
                    >
                        <div className="p-8 pt-24">
                            <h2 className="text-2xl font-semibold text-cyan-400 mb-8 select-none flex items-center">
                                <span className="w-3 h-3 bg-cyan-400 rounded-full mr-3 animate-pulse"></span>
                                Dashboards
                            </h2>
                            <ul className="space-y-3">
                                {/* @MAP: Object.entries(dashboards).map(([key, dash]) => ( */}
                                {Object.entries(dashboards).map(([key, dash]) => (
                                    <li key={key}>
                                        <button
                                            onClick={() => {
                                                setDashboard(key);
                                                setMenuOpen(false);
                                            }}
                                            className={`w-full text-left px-4 py-3 rounded-lg transition-all duration-200 flex items-center ${
                                                dashboard === key
                                                    ? "bg-cyan-600 font-bold neon-glow text-white"
                                                    : "font-normal hover:bg-gray-700 text-gray-300 hover:text-cyan-400"
                                            }`}
                                            data-event="click:changeDashboard"
                                        >
                                            <span className="text-xl mr-3">{dash.icon}</span>
                                            {dash.title}
                                        </button>
                                    </li>
                                ))}
                                {/* @END_MAP )) */}
                            </ul>
                        </div>
                    </nav>
                    {/* @END_COMPONENT: Sidebar */}

                    {/* @COMPONENT: MainContent - Primary dashboard content area */}
                    <main className="flex-grow pt-24 px-8 pb-10 max-w-7xl mx-auto w-full">
                        {/* Avatar + Dashboard Title Section */}
                        <section className="flex flex-col md:flex-row items-center md:space-x-8 mb-12 text-center md:text-left">
                            <Avatar3D />
                            <div>
                                <h2 className="text-4xl font-bold text-cyan-400 select-none mb-2">
                                    {dashboards[dashboard].title}
                                </h2>
                                <p className="text-gray-400 text-lg">
                                    Sistema integrado de informa√ß√µes m√©dicas sobre cannabis
                                </p>
                            </div>
                        </section>

                        {/* Dashboard Content */}
                        <section className="min-h-[400px]">
                            <DashboardCard 
                                title={dashboards[dashboard].title}
                                loading={loading}
                            >
                                {dashboards[dashboard].content}
                            </DashboardCard>
                        </section>

                        {/* Statistics Grid */}
                        <section className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8">
                            <div className="bg-gray-800 rounded-lg p-6 neon-border card-hover text-center">
                                <div className="text-3xl font-bold text-cyan-400" data-bind="stats.studies">
                                    {scientificData.length}
                                </div>
                                <div className="text-gray-400 mt-2">Estudos Cient√≠ficos</div>
                            </div>
                            <div className="bg-gray-800 rounded-lg p-6 neon-border card-hover text-center">
                                <div className="text-3xl font-bold text-cyan-400" data-bind="stats.cases">
                                    {clinicalCases.length}
                                </div>
                                <div className="text-gray-400 mt-2">Casos Cl√≠nicos</div>
                            </div>
                            <div className="bg-gray-800 rounded-lg p-6 neon-border card-hover text-center">
                                <div className="text-3xl font-bold text-cyan-400" data-bind="stats.alerts">
                                    {alerts.length}
                                </div>
                                <div className="text-gray-400 mt-2">Alertas Ativos</div>
                            </div>
                            <div className="bg-gray-800 rounded-lg p-6 neon-border card-hover text-center">
                                <div className="text-3xl font-bold text-cyan-400">98%</div>
                                <div className="text-gray-400 mt-2">Taxa de Efic√°cia</div>
                            </div>
                        </section>
                    </main>
                    {/* @END_COMPONENT: MainContent */}

                    {/* @COMPONENT: Footer - Application footer */}
                    <footer className="text-center text-gray-500 text-sm p-6 select-none border-t border-gray-800">
                        <div className="flex items-center justify-center space-x-2">
                            <span>&copy; 2025 Cannabis Clinical Hub</span>
                            <span className="w-1 h-1 bg-cyan-400 rounded-full"></span>
                            <span>Todos os direitos reservados</span>
                        </div>
                        <p className="mt-2 text-xs text-gray-600">
                            Sistema de gest√£o cl√≠nica para medicina baseada em cannabis
                        </p>
                    </footer>
                    {/* @END_COMPONENT: Footer */}

                    {/* Overlay for mobile menu */}
                    {menuOpen && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"
                            onClick={() => setMenuOpen(false)}
                        ></div>
                    )}
                </div>
            );
        }
        // @END_COMPONENT: App

        // Initialize React app
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>